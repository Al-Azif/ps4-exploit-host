"use strict";var _this=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var TMDB=function(){function a(){_classCallCheck(this,a),this.url="",this.json=""}return _createClass(a,[{key:"update",value:function b(a){a!==this.url&&(this.url=a,this.json=$.ajax({dataType:"json",url:this.url,async:!1}).responseJSON)}},{key:"icon",get:function a(){return void 0===this.json?void 0:this.json.icons[0].icon}},{key:"name",get:function a(){return void 0===this.json?void 0:this.json.names[0].name}}]),a}();function clearInputRPI(){$("#meta-info").hide(),$("#installURL").val("http://"),$("#pkgSearch").val(""),$("#uninstallID").val(""),$("#uninstallRadioGame").prop("checked",!0),$("#taskContentID").val(""),$("#taskRadioGame").prop("checked",!0),$("#taskID").val("")}function getPKGListRPI(){return $.ajax({dataType:"json",url:"/api/pkglist",async:!1}).responseJSON}function showResponseRPI(a,b){var c="";"fail"===a?c=" text-danger":"success"==a&&(c=" text-success"),$("#responseText").html("<p class=\"text-center".concat(c,"\">").concat(JSON.stringify(b),"</p>"))}function getTMDBURLRPI(a){var b,c,d,e="XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX";e=e.toUpperCase();var f=new jsSHA("SHA-256","TEXT");f.update(e);var g=f.getHash("HEX");return"2AB0555FABF50901A5D7CD56962769F0274374FA56C7E81E77EC386B22834AFB"===g.toUpperCase()?(b=new jsSHA("SHA-1","TEXT"),b.setHMACKey(e,"HEX"),b.update(a),c=b.getHMAC("HEX"),c=c.toUpperCase(),d="https://tmdb.np.dl.playstation.net/tmdb2/".concat(a,"_").concat(c,"/").concat(a,".json")):d="http://0.0.0.0",d}function displayTIDMetaRPI(a){window.Meta.update(getTMDBURLRPI(a)),window.Meta.icon!==void 0&&$("#meta-icon").attr("src",window.Meta.icon),window.Meta.name!==void 0&&$("#meta-name").text(window.Meta.name),window.Meta.icon===void 0&&window.Meta.name===void 0?$("#meta-info").hide():$("#meta-info").show()}function setLastIPRPI(a){var b,c=decodeURIComponent(document.cookie),d=c.split(";");$.each(d,function(a,c){for(;" "===c.charAt(0);)c=c.substring(1);0===c.indexOf("last_ip=")&&(b=c.substring(8,c.length))}),b===void 0?($(a).val("0.0.0.0"),document.cookie="last_ip=0.0.0.0; expires=Tue, 19 Jan 2038 03:14:07 UTC;"):$(a).val(b)}function validateInputRPI(a,b){var c;if("IP"===a)c=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;else if("URL"===a)c=/^http[s]?:\/\/.+/i;else if("ContentID"===a)c=/^[A-Z]{2}[0-9]{4}-[A-Z]{4}[0-9]{5}_[0-9]{2}-[A-Z0-9]{16}$/;else if("TitleID"===a)c=/^[A-Z]{4}[0-9]{5}$/;else if("TaskID"===a)c=/^(?:[1-9][0-9]{3}|[1-9][0-9]{2}|[1-9][0-9]|[0-9])$/;else return!1;return c.test(b)}function sendCommandRPI(a,b,c){var d="http://".concat(a,":12800/api/").concat(b);return validateInputRPI("IP",a)?(document.cookie="last_ip=".concat(a,"; expires=Tue, 19 Jan 2038 03:14:07 UTC;"),$.ajax({type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",url:d,data:c,async:!1,beforeSend:function a(){$("#sendingOverlay").show()},complete:function a(){$("#sendingOverlay").hide()}}).responseJSON):void alert("Invalid IP")}function isExistsRPI(a,b){var c,d;return validateInputRPI("TitleID",b.toUpperCase())?(c=sendCommandRPI(a,"is_exists","{\"title_id\": \"".concat(b.toUpperCase(),"\"}")),d=c.status,void showResponseRPI(d,c)):void alert("Validation Error")}function installRPI(a,b,c){var d,e;return validateInputRPI("URL",c)?("direct"===b?d=sendCommandRPI(a,"install","{\"type\": \"direct\", \"packages\": [\"".concat(c,"\"]}")):"ref_pkg_url"==b&&(d=sendCommandRPI(a,"install","{\"type\": \"ref_pkg_url\", \"url\": \"".concat(c,"\"}"))),e=d.status,void showResponseRPI(e,d)):void alert("Validation Error")}function uninstallRPI(a,b,c){var d,e;if("uninstall_game"===b||"uninstall_patch"===b){if(validateInputRPI("TitleID",c.toUpperCase()))return d=sendCommandRPI(a,b,"{\"title_id\": \"".concat(c.toUpperCase(),"\"}")),e=d.status,void showResponseRPI(e,d);}else if(("uninstall_ac"===b||"uninstall_theme"===b)&&validateInputRPI("ContentID",c.toUpperCase()))return d=sendCommandRPI(a,b,"{\"content_id\": \"".concat(c.toUpperCase(),"\"}")),e=d.status,void showResponseRPI(e,d);alert("Validation Error")}function findTaskRPI(a,b,c){var d,e;return validateInputRPI("ContentID",c.toUpperCase())?(d=sendCommandRPI(a,"find_task","{\"content_id\": \"".concat(c.toUpperCase(),"\", \"sub_type\": ").concat(b,"}")),e=d.status,void showResponseRPI(e,d)):void alert("Validation Error")}function taskRPI(a,b,c){var d,e;return validateInputRPI("TaskID",c)?(d=sendCommandRPI(a,b,"{\"task_id\": ".concat(c,"}")),e=d.status,void showResponseRPI(e,d)):void alert("Validation Error")}function makePkgButtonRPI(a,b,c){var g,d=Math.pow,e=Math.floor,f=Math.log,h=43,j=a.substring(0,h-3);a.length>h&&(j+="...");var k=0===b?0:e(f(b)/f(1024)),i="".concat(1*(b/d(1024,k)).toFixed(2)," ").concat(["B","kB","MB","GB","TB"][k]);return g="<button type=\"button\" class=\"btn-pkg-list list-group-item list-group-item-action p-0 pb-1 pl-2\" ",g+="data-pkg-url=\"".concat(c,"\">"),g+="".concat(j,"<span class=\"badge badge-primary ml-1\">").concat(i,"</span></button>"),g}function makePkgArrayRPI(a){var b="";return void 0!==a&&$.each(a,function(a,c){"No PKGs Found"===c?b="<p class=\"text-center text-danger\">No PKGs found on host</p>":"I/O Error on Host"===c?b="<p class=\"text-center text-danger\">I/O error on host</p>":"No results"===c?b="<p class=\"text-center text-danger\">No results</p>":b+=makePkgButtonRPI(c.Filename,c.Filesize,c.File_URL)}),""===b&&(b="<p class=\"text-center text-danger\">Error connecting to host</p>"),b}function checkPkgLink(){var a,b=/[A-Z]{2}[0-9]{4}-([A-Z]{4}[0-9]{5}_[0-9]{2})-[A-Z0-9]{16}/i,c=/([A-Z]{4}[0-9]{5})/i;b.test($("#installURL").val())?(a=b.exec($("#installURL").val()),a=a[1].toUpperCase(),displayTIDMetaRPI(a)):c.test($("#installURL").val())?(a=c.exec($("#installURL").val()),a="".concat(a[1].toUpperCase(),"_00"),displayTIDMetaRPI(a)):$("#meta-info").hide()}$(function(){var a,b;if(window.Meta=new TMDB,!navigator.onLine)return void $("#offlineOverlay").show();setLastIPRPI("#ip"),clearInputRPI();var c=getPKGListRPI();$("a[data-toggle=\"pill\"]").click(function(){clearInputRPI(),$("#header").text($(_this).text())}),$("#pkgSearch").keyup(function(){a=[],"No PKGs Found"!==c&&"I/O Error on Host"!==c&&(b=$("#pkgSearch").val().toUpperCase(),$.each(c,function(c,d){-1<d.Filename.toUpperCase().indexOf(b)&&a.push(d)}),void 0!==c&&0===a.length&&(a=["No results"]),$("#pkg-list").html(makePkgArrayRPI(a)))}),$("#installURL").keyup(checkPkgLink),$("#btn-exists").click(function(){isExistsRPI($("#ip").val(),$("#existID").val())}),$("#btn-install-cdn").click(function(){installRPI($("#ip").val(),"ref_pkg_url",$("#installURL").val())}),$("#btn-install-url").click(function(){installRPI($("#ip").val(),"direct",$("#installURL").val())}),$("#btn-uninstall").click(function(){uninstallRPI($("#ip").val(),$("input[name='uninstallRadios']:checked").val(),$("#uninstallID").val())}),$("#btn-task-find").click(function(){findTaskRPI($("#ip").val(),$("input[name='taskRadios']:checked").val(),$("#taskContentID").val())}),$("#btn-task-star").click(function(){taskRPI($("#ip").val(),"start_task",$("#taskID").val())}),$("#btn-task-stop").click(function(){taskRPI($("#ip").val(),"stop_task",$("#taskID").val())}),$("#btn-task-pause").click(function(){taskRPI($("#ip").val(),"pause_task",$("#taskID").val())}),$("#btn-task-resume").click(function(){taskRPI($("#ip").val(),"resume_task",$("#taskID").val())}),$("#btn-task-unregister").click(function(){taskRPI($("#ip").val(),"unregister_task",$("#taskID").val())}),$("#btn-task-progress").click(function(){taskRPI($("#ip").val(),"get_task_progress",$("#taskID").val())}),$("#pkg-list").html(makePkgArrayRPI(c)),$(".btn-pkg-list").click(function(a){$("#installURL").val($(a.target).data("pkg-url")),checkPkgLink()})});
